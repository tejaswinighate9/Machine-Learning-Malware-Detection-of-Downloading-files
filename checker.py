#! /usr/bin/python2
#pefile is a Python module to read and work with PE (Portable Executable) files.
import pefile
import os
import array
import math
import pickle
import joblib
import sys
import argparse
import os, sys, shutil, time
import re
import pandas as pd
import prepareDS

from flask import Flask, request, jsonify, render_template,abort,redirect,url_for
from werkzeug.utils import secure_filename
from sklearn.ensemble import RandomForestClassifier

def cutit(s,n):
   return s[n:]

app = Flask(__name__)




@app.route('/')
def home():
    return render_template('index.html')


	
@app.route('/uploader', methods = ['GET', 'POST'])
def upload_file():
   if request.method == 'POST':
    f = request.files['file']
    f.save(secure_filename(f.filename))
    ##########################################
    row = prepareDS.prepare_input('C:\\Users\\Dell\\Desktop\\Final-year-Project\\' + f.filename)

    # Load classifier
    clf = joblib.load(os.path.join(os.path.dirname(os.path.realpath('classifier.pkl')),'C:\\Users\\Dell\\Desktop\\Project\\classifier.pkl'))
    y = clf.predict([row])

    if y == ['pe-legit']:
        res = 1
    else:
        res = 0  
    
    return render_template('result.html', prediction = ['malicious', 'legitimate'][res])

if __name__ == '__main__':
  app.run(debug = True)
